language: smalltalk
sudo: false

os:
  - linux

smalltalk:
  - Pharo-6.1

# Unit tests run the normal pillar tests
# Integration tests test that pillar itself can interact with generated files, pdf generation, etc.
# System tests test that we can install and use pillar as a black box
env:
  matrix:
  - JOB=test TYPE=System ARCHETYPE=book OUTPUT=pdf

install:
  # Pillar installation
  - git clone https://github.com/pillar-markup/pillar.git -b dev-7 # Clone pillar
  - cd pillar && ./scripts/build.sh && cd ..                              # Run pillar build script. Pillar will be built in `pwd`/build!
  - . pillar/scripts/ci/ensure_latex.sh                                   # Install latex
  - ./pillar/scripts/ci/ensure_book_dependencies.sh                       # Install latex dependencies required by pillar

script:
  - ./pillar/build/pillar build pdf

after_success:
  - wget -c https://github.com/probonopd/uploadtool/raw/master/upload.sh
  - mv _result/pdf/index.pdf Clap-wip.pdf
  - bash upload.sh Clap-wip.pdf

branches:
  except:
    - /^(?i:continuous)$/

deploy:
- provider: bintray
  file: .bintray.json
  on:
    repo: SquareBracketAssociates/Booklet-ClapCommandLine
  skip_cleanup: true
  user: ducasse
  key:
    secure: TmtxTHbMdFHKlksXjPZMWmRskdODGriBieqLKSsXFs2oobq8oGGMPntyGHPXiS4SaiSgTo5GuilkJz93hvt6AazDRPtHe+JsO6FehNLW2ic4NgKIK59wMajIgiXMzNh5IZ1N9nTaoA959emPLfqP0t8qAtKbQPovW0xrwtyOW7BZYArhcXZ1tER4y+CPI+wjHVrwd4gYBARlRk+LHnnHiq1ORl1OBiTpGkoMegqOE/BuARL3DAB06JHIarwyXS7Xa7wtDVpJqTFAnTUg36ZmvK+hneL6YBR1oLsAoDZ5AZy6bTLD5zQxW2ctDIqdRosWElAHmmMNUduJMC3y1+jdwM0f0UiBEJYvzuQbSquMQWlCjXjHbYsNvBwTuUemSt3KkMkaWtoiAAdJ9O24e0XEfuIbbTcds8+rHIL/q2iY4/FiuUmBxQ4hJEgme6rABhO8sUsFCbXsAppJaKDw9Z4dY54U+0ZQPqvA2iEhBQSBFw8uPfUy0AyUflxTbBkeM2TJmb7U5NaWmQNcXOUs7g6wpoH2hsbq+BPt5hJsbKSIioP+cl7iO3nvDxfuyZq9GZ7EAtcdOUJjrdElbzaHGM72HehxdqdY2scdjBYT5wTr/9xVvxBSCz4SBmTs3daOVTBfhguU9Olbef86ddyt29BrLH1uoERiqKYSqTZt49ZGWzg=
